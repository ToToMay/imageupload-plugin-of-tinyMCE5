var fs=require('fs');
(function () {

  var global = tinymce.util.Tools.resolve('tinymce.PluginManager');
  function selectLocalImages(editor) {	
    var dom = editor.dom;
    remote.dialog.showOpenDialog({//打开选择文件按钮
      properties:['openFile', 'showHiddenFiles'],
      defaultPath:'C:\Users\Administrator\Desktop',
      filters: [{
        name: 'Image', 
        extensions: ['jpg','jpeg','png','gif'] 
      }],
      title:'选择图片'
  }).then(result => {
      if(result.canceled ==false){
        var path=result.filePaths[0];
        path=path.replace(/\\/g,"/");//替换反斜杠
        var ext = path.substring(path.lastIndexOf(".")+1);//获取拓展名
        var imageData = fs.readFileSync(path)
        var imageBase64 = imageData.toString("base64");
        editor.focus();
        var image64 = 'data:image/'+ext+';base64,' +imageBase64
        editor.selection.setContent(dom.createHTML('img', {src: image64 }));
      }}).catch(err => {
      console.log(err) })
  }
  
  var register$1 = function (editor) {
    editor.ui.registry.addButton('uploadimage', {
      icon: 'image',
      tooltip: '上传图片',
      onAction: function () {
        selectLocalImages(editor)
      }
    });
    editor.ui.registry.addMenuItem('uploadimage', {
      icon: 'image',
      text: '上传图片',
      onAction: function () {
        selectLocalImages(editor)
      }
    });
  };
  var Buttons = { register: register$1 };
  function Plugin () {
    global.add('uploadimage', function (editor) {        
      Buttons.register(editor);
    });
  }
  Plugin();
}());
